\hypertarget{cli_8h}{
\section{cli.h File Reference}
\label{cli_8h}\index{cli.h@{cli.h}}
}


Standard Command Line Interface.  


{\ttfamily \#include \char`\"{}linkedlist.h\char`\"{}}\par
{\ttfamily \#include $<$pthread.h$>$}\par
{\ttfamily \#include $<$netdb.h$>$}\par
{\ttfamily \#include $<$time.h$>$}\par
{\ttfamily \#include $<$sys/param.h$>$}\par
{\ttfamily \#include $<$unistd.h$>$}\par
{\ttfamily \#include $<$errno.h$>$}\par
{\ttfamily \#include $<$string.h$>$}\par
{\ttfamily \#include $<$stdio.h$>$}\par
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structspd__cli__arg}{spd\_\-cli\_\-arg}
\item 
struct \hyperlink{structspd__cli__entry}{spd\_\-cli\_\-entry}
\end{DoxyCompactItemize}
\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\hypertarget{cli_8h_a4f3ad5e5686a35a966c8bad5b8694654}{
\#define {\bfseries CLI\_\-NO\_\-PERMS}~-\/1}
\label{cli_8h_a4f3ad5e5686a35a966c8bad5b8694654}

\item 
\hypertarget{cli_8h_a7cc1753a05a0821f6c70dd2bccfbab5c}{
\#define {\bfseries RESULT\_\-SUCCESS}~0}
\label{cli_8h_a7cc1753a05a0821f6c70dd2bccfbab5c}

\item 
\hypertarget{cli_8h_a76ed22cec1f42c93a5b4eed8d967338f}{
\#define {\bfseries RESULT\_\-SHOWUSAGE}~1}
\label{cli_8h_a76ed22cec1f42c93a5b4eed8d967338f}

\item 
\hypertarget{cli_8h_aea87ce97f86effb2c4df6274d4aac567}{
\#define {\bfseries RESULT\_\-FAILURE}~2}
\label{cli_8h_aea87ce97f86effb2c4df6274d4aac567}

\item 
\hypertarget{cli_8h_a50989f00b32eeb2516a3803cb2ffb766}{
\#define {\bfseries CLI\_\-SUCCESS}~(char $\ast$)RESULT\_\-SUCCESS}
\label{cli_8h_a50989f00b32eeb2516a3803cb2ffb766}

\item 
\hypertarget{cli_8h_a0873456096960dab21fff0ce68c95acb}{
\#define {\bfseries CLI\_\-SHOWUSAGE}~(char $\ast$)RESULT\_\-SHOWUSAGE}
\label{cli_8h_a0873456096960dab21fff0ce68c95acb}

\item 
\hypertarget{cli_8h_ae47751901c430ebb833e59291a5e0b3f}{
\#define {\bfseries CLI\_\-FAILURE}~(char $\ast$)RESULT\_\-FAILURE}
\label{cli_8h_ae47751901c430ebb833e59291a5e0b3f}

\item 
\hypertarget{cli_8h_af1424ac5021a4530ce69dbe071bee19f}{
\#define {\bfseries SPD\_\-MAX\_\-CMD\_\-LEN}~16}
\label{cli_8h_af1424ac5021a4530ce69dbe071bee19f}

\item 
\hypertarget{cli_8h_a9d8f3d66fcb6d00cbb2b902e0ecd6cbf}{
\#define {\bfseries SPD\_\-MAX\_\-ARGS}~64}
\label{cli_8h_a9d8f3d66fcb6d00cbb2b902e0ecd6cbf}

\item 
\hypertarget{cli_8h_a90e9d33583b0a3d50b9a195693fe02ca}{
\#define {\bfseries SPD\_\-CLI\_\-COMPLETE\_\-EOF}~\char`\"{}\_\-EOF\_\-\char`\"{}}
\label{cli_8h_a90e9d33583b0a3d50b9a195693fe02ca}

\item 
\#define \hyperlink{cli_8h_aa09c07179fe1c89f52bb28bc126d26f2}{ESS}(x)~((x) == 1 ? \char`\"{}\char`\"{} : \char`\"{}s\char`\"{})
\item 
\hypertarget{cli_8h_a6c2daaea0ed11b22f402bbb5ec24e965}{
\#define \hyperlink{cli_8h_a6c2daaea0ed11b22f402bbb5ec24e965}{SPD\_\-CLI\_\-YESNO}(x)~(x) ? \char`\"{}Yes\char`\"{} : \char`\"{}No\char`\"{}}
\label{cli_8h_a6c2daaea0ed11b22f402bbb5ec24e965}

\begin{DoxyCompactList}\small\item\em return Yes or No depending on the argument. This is used in many places in CLI command, having a function to generate this helps maintaining a consistent output (and possibly emitting the output in other languages, at some point). \item\end{DoxyCompactList}\item 
\hypertarget{cli_8h_a6354aff5b075f7ae7114f16a2474850b}{
\#define \hyperlink{cli_8h_a6354aff5b075f7ae7114f16a2474850b}{SPD\_\-CLI\_\-INOFF}(x)~(x) ? \char`\"{}On\char`\"{} : \char`\"{}Off\char`\"{}}
\label{cli_8h_a6354aff5b075f7ae7114f16a2474850b}

\begin{DoxyCompactList}\small\item\em return On or Off depending on the argument. This is used in many places in CLI command, having a function to generate this helps maintaining a consistent output (and possibly emitting the output in other languages, at some point). \item\end{DoxyCompactList}\item 
\hypertarget{cli_8h_aa0c0ca8781aa570fb30c11ee1e2c7aad}{
\#define {\bfseries SPD\_\-CLI\_\-DEFINE}(callback, summar,...)~\{.handler = callback, .summary = summar, \#\# \_\-\_\-VA\_\-ARGS\_\-\_\- \}}
\label{cli_8h_aa0c0ca8781aa570fb30c11ee1e2c7aad}

\item 
\hypertarget{cli_8h_a5489c4051c728121fe836b2f6f61fd09}{
\#define {\bfseries spd\_\-cli\_\-command}(fd, s)~spd\_\-cli\_\-command\_\-full(CLI\_\-NO\_\-PERMS, CLI\_\-NO\_\-PERMS, fd, (s))}
\label{cli_8h_a5489c4051c728121fe836b2f6f61fd09}

\item 
\hypertarget{cli_8h_a8cb1dab397d0ebad280a5390e1d7b8eb}{
\#define {\bfseries spd\_\-cli\_\-command\_\-multiple}(fd, size, s)~spd\_\-cli\_\-command\_\-multiple\_\-full(CLI\_\-NO\_\-PERMS, CLI\_\-NO\_\-PERMS, fd, size, s)}
\label{cli_8h_a8cb1dab397d0ebad280a5390e1d7b8eb}

\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries spd\_\-cli\_\-command} \{ {\bfseries CLI\_\-USAGE}, 
{\bfseries CLI\_\-COMPLETE}, 
{\bfseries CLI\_\-HANDLER}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
char $\ast$ \hyperlink{cli_8h_ae9213078223ba961ffa288851e2611b4}{spd\_\-cli\_\-complete} (const char $\ast$word, const char $\ast$const choices\mbox{[}$\,$\mbox{]}, int state)
\item 
int \hyperlink{cli_8h_af8427858cf1a26b7a6bd9b17f3cd807f}{spd\_\-command\_\-full} (int uid, int gid, int fd, const char $\ast$a)
\begin{DoxyCompactList}\small\item\em Interprets a command Interpret a command s, sending output to fd if uid:gid has permissions to run this command. uid = CLI\_\-NO\_\-PERMS to avoid checking user permissions gid = CLI\_\-NO\_\-PERMS to avoid checking group permissions. \item\end{DoxyCompactList}\item 
int \hyperlink{cli_8h_a875db88212938ee6b94b54cc94cf0e91}{spd\_\-cli\_\-command\_\-multiple\_\-full} (int uid, int gid, int fd, size\_\-t size, const char $\ast$s)
\begin{DoxyCompactList}\small\item\em Executes multiple CLI commands Interpret strings separated by NULL and execute each one, sending output to fd if uid has permissions, uid = CLI\_\-NO\_\-PERMS to avoid checking users permissions. gid = CLI\_\-NO\_\-PERMS to avoid checking group permissions. \item\end{DoxyCompactList}\item 
int \hyperlink{cli_8h_a1f8b3da61ef0b5d9b6c55ab5d19e960a}{spd\_\-cli\_\-register} (struct \hyperlink{structspd__cli__entry}{spd\_\-cli\_\-entry} $\ast$e)
\begin{DoxyCompactList}\small\item\em Registers a command or an array of commands. \item\end{DoxyCompactList}\item 
int \hyperlink{cli_8h_ade9564322eb63121243c28c2e932788f}{spd\_\-cli\_\-register\_\-multiple} (struct \hyperlink{structspd__cli__entry}{spd\_\-cli\_\-entry} $\ast$e, int len)
\begin{DoxyCompactList}\small\item\em Register multiple commands. \item\end{DoxyCompactList}\item 
int \hyperlink{cli_8h_a143a60bddf33a2e7b69c5630d2143e10}{spd\_\-cli\_\-unregister} (struct \hyperlink{structspd__cli__entry}{spd\_\-cli\_\-entry} $\ast$e)
\begin{DoxyCompactList}\small\item\em Unregisters a command or an array of commands. \item\end{DoxyCompactList}\item 
int \hyperlink{cli_8h_a34b118fe7b59aa71e15c30911ddece70}{spd\_\-cli\_\-unregister\_\-multiple} (struct \hyperlink{structspd__cli__entry}{spd\_\-cli\_\-entry} $\ast$e, int len)
\begin{DoxyCompactList}\small\item\em Unregister multiple commands. \item\end{DoxyCompactList}\item 
char $\ast$ \hyperlink{cli_8h_a7b7471f08e7f563934d7a26b2ab05c3d}{spd\_\-cli\_\-generator} (const char $\ast$, const char $\ast$, int)
\begin{DoxyCompactList}\small\item\em Readline madness Useful for readline, that's about it. \item\end{DoxyCompactList}\item 
\hypertarget{cli_8h_a01ac159e5c7854e62f794756fb70a41b}{
int {\bfseries spd\_\-cli\_\-generatornummatches} (const char $\ast$, const char $\ast$)}
\label{cli_8h_a01ac159e5c7854e62f794756fb70a41b}

\item 
char $\ast$$\ast$ \hyperlink{cli_8h_abb73af2bf7fc32b38c9be91a0c42f51d}{spd\_\-cli\_\-completion\_\-matches} (const char $\ast$, const char $\ast$)
\begin{DoxyCompactList}\small\item\em Generates a NULL-\/terminated array of strings that 1) begin with the string in the second parameter, and 2) are valid in a command after the string in the first parameter. \item\end{DoxyCompactList}\item 
\hypertarget{cli_8h_a8f801fe827f786dfb6a5f1eb26d57e75}{
void {\bfseries spd\_\-cli} (int fd, const char $\ast$fmt,...) \_\-\_\-attribute\_\-\_\-((format(printf}
\label{cli_8h_a8f801fe827f786dfb6a5f1eb26d57e75}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Standard Command Line Interface. 

\subsection{Define Documentation}
\hypertarget{cli_8h_aa09c07179fe1c89f52bb28bc126d26f2}{
\index{cli.h@{cli.h}!ESS@{ESS}}
\index{ESS@{ESS}!cli.h@{cli.h}}
\subsubsection[{ESS}]{\setlength{\rightskip}{0pt plus 5cm}\#define ESS(x)~((x) == 1 ? \char`\"{}\char`\"{} : \char`\"{}s\char`\"{})}}
\label{cli_8h_aa09c07179fe1c89f52bb28bc126d26f2}
In many cases we need to print singular or plural words depending on a count. This macro helps us e.g. printf(\char`\"{}we have \%d object\%s\char`\"{}, n, \hyperlink{cli_8h_aa09c07179fe1c89f52bb28bc126d26f2}{ESS(n)}); 

\subsection{Function Documentation}
\hypertarget{cli_8h_a875db88212938ee6b94b54cc94cf0e91}{
\index{cli.h@{cli.h}!spd\_\-cli\_\-command\_\-multiple\_\-full@{spd\_\-cli\_\-command\_\-multiple\_\-full}}
\index{spd\_\-cli\_\-command\_\-multiple\_\-full@{spd\_\-cli\_\-command\_\-multiple\_\-full}!cli.h@{cli.h}}
\subsubsection[{spd\_\-cli\_\-command\_\-multiple\_\-full}]{\setlength{\rightskip}{0pt plus 5cm}int spd\_\-cli\_\-command\_\-multiple\_\-full (int {\em uid}, \/  int {\em gid}, \/  int {\em fd}, \/  size\_\-t {\em size}, \/  const char $\ast$ {\em s})}}
\label{cli_8h_a875db88212938ee6b94b54cc94cf0e91}


Executes multiple CLI commands Interpret strings separated by NULL and execute each one, sending output to fd if uid has permissions, uid = CLI\_\-NO\_\-PERMS to avoid checking users permissions. gid = CLI\_\-NO\_\-PERMS to avoid checking group permissions. 


\begin{DoxyParams}{Parameters}
\item[{\em uid}]User ID that is trying to run the command. \item[{\em gid}]Group ID that is trying to run the command. \item[{\em fd}]pipe \item[{\em size}]is the total size of the string \item[{\em s}]incoming string \end{DoxyParams}

\begin{DoxyRetVals}{Return values}
\item[{\em number}]of commands executed \end{DoxyRetVals}
\hypertarget{cli_8h_ae9213078223ba961ffa288851e2611b4}{
\index{cli.h@{cli.h}!spd\_\-cli\_\-complete@{spd\_\-cli\_\-complete}}
\index{spd\_\-cli\_\-complete@{spd\_\-cli\_\-complete}!cli.h@{cli.h}}
\subsubsection[{spd\_\-cli\_\-complete}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ spd\_\-cli\_\-complete (const char $\ast$ {\em word}, \/  const char $\ast$const  {\em choices}\mbox{[}$\,$\mbox{]}, \/  int {\em state})}}
\label{cli_8h_ae9213078223ba961ffa288851e2611b4}
Helper function to generate cli entries from a NULL-\/terminated array. Returns the n-\/th matching entry from the array, or NULL if not found. Can be used to implement generate() for static entries as below (in this example we complete the word in position 2): 
\begin{DoxyCode}
    char *my_generate(const char *line, const char *word, int pos, int n)
    {
        static const char * const choices[] = { "one", "two", "three", NULL };
        if (pos == 2)
                return spd_cli_complete(word, choices, n);
        else
                return NULL;
    }
\end{DoxyCode}
 \hypertarget{cli_8h_abb73af2bf7fc32b38c9be91a0c42f51d}{
\index{cli.h@{cli.h}!spd\_\-cli\_\-completion\_\-matches@{spd\_\-cli\_\-completion\_\-matches}}
\index{spd\_\-cli\_\-completion\_\-matches@{spd\_\-cli\_\-completion\_\-matches}!cli.h@{cli.h}}
\subsubsection[{spd\_\-cli\_\-completion\_\-matches}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$$\ast$ spd\_\-cli\_\-completion\_\-matches (const char $\ast$, \/  const char $\ast$)}}
\label{cli_8h_abb73af2bf7fc32b38c9be91a0c42f51d}


Generates a NULL-\/terminated array of strings that 1) begin with the string in the second parameter, and 2) are valid in a command after the string in the first parameter. 

The first entry (offset 0) of the result is the longest common substring in the results, useful to extend the string that has been completed. Subsequent entries are all possible values, followed by a NULL. All strings and the array itself are malloc'ed and must be freed by the caller. \hypertarget{cli_8h_a7b7471f08e7f563934d7a26b2ab05c3d}{
\index{cli.h@{cli.h}!spd\_\-cli\_\-generator@{spd\_\-cli\_\-generator}}
\index{spd\_\-cli\_\-generator@{spd\_\-cli\_\-generator}!cli.h@{cli.h}}
\subsubsection[{spd\_\-cli\_\-generator}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ spd\_\-cli\_\-generator (const char $\ast$, \/  const char $\ast$, \/  int)}}
\label{cli_8h_a7b7471f08e7f563934d7a26b2ab05c3d}


Readline madness Useful for readline, that's about it. 


\begin{DoxyRetVals}{Return values}
\item[{\em 0}]on success \item[{\em -\/1}]on failure \end{DoxyRetVals}
\hypertarget{cli_8h_a1f8b3da61ef0b5d9b6c55ab5d19e960a}{
\index{cli.h@{cli.h}!spd\_\-cli\_\-register@{spd\_\-cli\_\-register}}
\index{spd\_\-cli\_\-register@{spd\_\-cli\_\-register}!cli.h@{cli.h}}
\subsubsection[{spd\_\-cli\_\-register}]{\setlength{\rightskip}{0pt plus 5cm}int spd\_\-cli\_\-register (struct {\bf spd\_\-cli\_\-entry} $\ast$ {\em e})}}
\label{cli_8h_a1f8b3da61ef0b5d9b6c55ab5d19e960a}


Registers a command or an array of commands. 


\begin{DoxyParams}{Parameters}
\item[{\em e}]which cli entry to register. Register your own command \end{DoxyParams}

\begin{DoxyRetVals}{Return values}
\item[{\em 0}]on success \item[{\em -\/1}]on failure \end{DoxyRetVals}
\hypertarget{cli_8h_ade9564322eb63121243c28c2e932788f}{
\index{cli.h@{cli.h}!spd\_\-cli\_\-register\_\-multiple@{spd\_\-cli\_\-register\_\-multiple}}
\index{spd\_\-cli\_\-register\_\-multiple@{spd\_\-cli\_\-register\_\-multiple}!cli.h@{cli.h}}
\subsubsection[{spd\_\-cli\_\-register\_\-multiple}]{\setlength{\rightskip}{0pt plus 5cm}int spd\_\-cli\_\-register\_\-multiple (struct {\bf spd\_\-cli\_\-entry} $\ast$ {\em e}, \/  int {\em len})}}
\label{cli_8h_ade9564322eb63121243c28c2e932788f}


Register multiple commands. 


\begin{DoxyParams}{Parameters}
\item[{\em e}]pointer to first cli entry to register \item[{\em len}]number of entries to register \end{DoxyParams}
\hypertarget{cli_8h_a143a60bddf33a2e7b69c5630d2143e10}{
\index{cli.h@{cli.h}!spd\_\-cli\_\-unregister@{spd\_\-cli\_\-unregister}}
\index{spd\_\-cli\_\-unregister@{spd\_\-cli\_\-unregister}!cli.h@{cli.h}}
\subsubsection[{spd\_\-cli\_\-unregister}]{\setlength{\rightskip}{0pt plus 5cm}int spd\_\-cli\_\-unregister (struct {\bf spd\_\-cli\_\-entry} $\ast$ {\em e})}}
\label{cli_8h_a143a60bddf33a2e7b69c5630d2143e10}


Unregisters a command or an array of commands. 


\begin{DoxyParams}{Parameters}
\item[{\em e}]which cli entry to unregister Unregister your own command. You must pass a completed \hyperlink{structspd__cli__entry}{spd\_\-cli\_\-entry} structure \end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 
\end{DoxyReturn}
\hypertarget{cli_8h_a34b118fe7b59aa71e15c30911ddece70}{
\index{cli.h@{cli.h}!spd\_\-cli\_\-unregister\_\-multiple@{spd\_\-cli\_\-unregister\_\-multiple}}
\index{spd\_\-cli\_\-unregister\_\-multiple@{spd\_\-cli\_\-unregister\_\-multiple}!cli.h@{cli.h}}
\subsubsection[{spd\_\-cli\_\-unregister\_\-multiple}]{\setlength{\rightskip}{0pt plus 5cm}int spd\_\-cli\_\-unregister\_\-multiple (struct {\bf spd\_\-cli\_\-entry} $\ast$ {\em e}, \/  int {\em len})}}
\label{cli_8h_a34b118fe7b59aa71e15c30911ddece70}


Unregister multiple commands. 


\begin{DoxyParams}{Parameters}
\item[{\em e}]pointer to first cli entry to unregister \item[{\em len}]number of entries to unregister \end{DoxyParams}
\hypertarget{cli_8h_af8427858cf1a26b7a6bd9b17f3cd807f}{
\index{cli.h@{cli.h}!spd\_\-command\_\-full@{spd\_\-command\_\-full}}
\index{spd\_\-command\_\-full@{spd\_\-command\_\-full}!cli.h@{cli.h}}
\subsubsection[{spd\_\-command\_\-full}]{\setlength{\rightskip}{0pt plus 5cm}int spd\_\-command\_\-full (int {\em uid}, \/  int {\em gid}, \/  int {\em fd}, \/  const char $\ast$ {\em a})}}
\label{cli_8h_af8427858cf1a26b7a6bd9b17f3cd807f}


Interprets a command Interpret a command s, sending output to fd if uid:gid has permissions to run this command. uid = CLI\_\-NO\_\-PERMS to avoid checking user permissions gid = CLI\_\-NO\_\-PERMS to avoid checking group permissions. 


\begin{DoxyParams}{Parameters}
\item[{\em uid}]User ID that is trying to run the command. \item[{\em gid}]Group ID that is trying to run the command. \item[{\em fd}]pipe \item[{\em s}]incoming string \end{DoxyParams}

\begin{DoxyRetVals}{Return values}
\item[{\em 0}]on success \item[{\em -\/1}]on failure \end{DoxyRetVals}
