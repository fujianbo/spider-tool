<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>spider-tool: obj_iterator Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>obj_iterator Struct Reference</h1><!-- doxytag: class="obj_iterator" -->
<p>When we need to walk through a container, we use an ao2_iterator to keep track of the current position.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="obj_8h_source.html">obj.h</a>&gt;</code></p>

<p><a href="structobj__iterator-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct obj_container *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structobj__iterator.html#a5ecf21f7dd1f55e01db059a59c9d0d85">c</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structobj__iterator.html#a09adf4a77131fe2d9a4a295cd694500a">flags</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structobj__iterator.html#a5c2c1cc03d280d34568eb6abade757bb">bucket</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structobj__iterator.html#afb5ef4e84bc1785aa3948f502bae545c">c_version</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structobj__iterator.html#aa50a51c930aa20abd91194f03f0265b3">obj</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structobj__iterator.html#a1051579d4ab6b9e35195160229ef9fd6">version</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>When we need to walk through a container, we use an ao2_iterator to keep track of the current position. </p>
<p>Because the navigation is typically done without holding the lock on the container across the loop, objects can be inserted or deleted or moved while we work. As a consequence, there is no guarantee that we manage to touch all the elements in the container, and it is possible that we touch the same object multiple times.</p>
<p>However, within the current hash table container, the following is true:</p>
<ul>
<li>It is not possible to miss an object in the container while iterating unless it gets added after the iteration begins and is added to a bucket that is before the one the current object is in. In this case, even if you locked the container around the entire iteration loop, you still would not see this object, because it would still be waiting on the container lock so that it can be added.</li>
<li>It would be extremely rare to see an object twice. The only way this can happen is if an object got unlinked from the container and added again during the same iteration. Furthermore, when the object gets added back, it has to be in the current or later bucket for it to be seen again.</li>
</ul>
<p>An iterator must be first initialized with ao2_iterator_init(), then we can use o = ao2_iterator_next() to move from one element to the next. Remember that the object returned by ao2_iterator_next() has its refcount incremented, and the reference must be explicitly released when done with it.</p>
<p>In addition, ao2_iterator_init() will hold a reference to the container being iterated, which will be freed when ao2_iterator_destroy() is called to free up the resources used by the iterator (if any).</p>
<p>Example:</p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span>ao2_container *c = ... <span class="comment">// the container we want to iterate on</span>
  <span class="keyword">struct </span>ao2_iterator i;
  <span class="keyword">struct </span>my_obj *o;

  i = ao2_iterator_init(c, <a class="code" href="structobj__iterator.html#a09adf4a77131fe2d9a4a295cd694500a">flags</a>);

  <span class="keywordflow">while</span> ((o = ao2_iterator_next(&amp;i))) {
     ... <span class="keywordflow">do</span> something on o ...
     ao2_ref(o, -1);
  }

  ao2_iterator_destroy(&amp;i);
</pre></div><p>The obj iterator </p>
<dl class="note"><dt><b>Note:</b></dt><dd>You are not supposed to know the internals of an iterator! We would like the iterator to be opaque, unfortunately its size needs to be known if we want to store it around without too much trouble. Anyways... The iterator has a pointer to the container, and a flags field specifying various things e.g. whether the container should be locked or not while navigating on it. The iterator "points" to the current object, which is identified by three values:</dd></dl>
<ul>
<li>a bucket number;</li>
<li>the object_id, which is also the container version number when the object was inserted. This identifies the object uniquely, however reaching the desired object requires scanning a list.</li>
<li>a pointer, and a container version when we saved the pointer. If the container has not changed its version number, then we can safely follow the pointer to reach the object in constant time.</li>
</ul>
<p>Details are in the implementation of ao2_iterator_next() A freshly-initialized iterator has bucket=0, version=0. </p>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a5c2c1cc03d280d34568eb6abade757bb"></a><!-- doxytag: member="obj_iterator::bucket" ref="a5c2c1cc03d280d34568eb6abade757bb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="structobj__iterator.html#a5c2c1cc03d280d34568eb6abade757bb">obj_iterator::bucket</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>current bucket </p>

</div>
</div>
<a class="anchor" id="a5ecf21f7dd1f55e01db059a59c9d0d85"></a><!-- doxytag: member="obj_iterator::c" ref="a5ecf21f7dd1f55e01db059a59c9d0d85" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct obj_container* <a class="el" href="structobj__iterator.html#a5ecf21f7dd1f55e01db059a59c9d0d85">obj_iterator::c</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>the container </p>

</div>
</div>
<a class="anchor" id="afb5ef4e84bc1785aa3948f502bae545c"></a><!-- doxytag: member="obj_iterator::c_version" ref="afb5ef4e84bc1785aa3948f502bae545c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="structobj__iterator.html#afb5ef4e84bc1785aa3948f502bae545c">obj_iterator::c_version</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>container version </p>

</div>
</div>
<a class="anchor" id="a09adf4a77131fe2d9a4a295cd694500a"></a><!-- doxytag: member="obj_iterator::flags" ref="a09adf4a77131fe2d9a4a295cd694500a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="structobj__iterator.html#a09adf4a77131fe2d9a4a295cd694500a">obj_iterator::flags</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>operation flags </p>

</div>
</div>
<a class="anchor" id="aa50a51c930aa20abd91194f03f0265b3"></a><!-- doxytag: member="obj_iterator::obj" ref="aa50a51c930aa20abd91194f03f0265b3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* <a class="el" href="structobj__iterator.html#aa50a51c930aa20abd91194f03f0265b3">obj_iterator::obj</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>pointer to the current object </p>

</div>
</div>
<a class="anchor" id="a1051579d4ab6b9e35195160229ef9fd6"></a><!-- doxytag: member="obj_iterator::version" ref="a1051579d4ab6b9e35195160229ef9fd6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="structobj__iterator.html#a1051579d4ab6b9e35195160229ef9fd6">obj_iterator::version</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>container version when the object was created </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li><a class="el" href="obj_8h_source.html">obj.h</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Jan 18 13:13:30 2012 for spider-tool by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
